<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SoleMate - Finding Perfect Shoes</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  background:linear-gradient(135deg,#fff,#FFFDF2);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.container{
  background:#FFFDF2;
  border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
  max-width:1200px;
  width:100%;
  overflow:hidden;
}
.header{
  background:#000;
  color:white;
  padding:30px;
  text-align:center;
}
.header h1{font-size:2.5em;margin-bottom:10px;}
.content{padding:40px;}
.screen{display:none;}
.screen.active{display:block;}
.btn{
  padding:12px 28px;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:white;
  border:none;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
  margin:5px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.btn:hover{transform:translateY(-2px);}
.top-controls{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  margin:15px 0;
  flex-wrap:wrap;
}
.filter-toggle{
  margin-top:4px; /* aligns better with input and other button */
}
.filter-panel{
  display:none;
  background:#f8f9ff;
  padding:20px;
  border-radius:10px;
  margin-bottom:20px;
}
.filter-panel.show{display:block;}
.options{display:grid;gap:10px;}
.option{
  padding:10px 15px;
  border:2px solid #e0e0e0;
  border-radius:8px;
  cursor:pointer;
  background:white;
}
.option.selected{
  background:#667eea;
  color:white;
  border-color:#667eea;
}
.shoes-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:20px;
}
.shoe-card{
  border:2px solid #e0e0e0;
  border-radius:12px;
  padding:15px;
  background:white;
  transition:0.3s;
}
.shoe-card:hover{
  transform:translateY(-5px);
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
  border-color:#667eea;
}
.shoe-image img{
  width:100%;
  height:180px;
  object-fit:cover;
  border-radius:10px;
}
.shoe-name{font-weight:600;margin:10px 0;}
.shoe-price{font-weight:700;color:#764ba2;}
.questionnaire{max-width:600px;margin:0 auto;text-align:center;}
.question{margin-bottom:25px;}
</style>
</head>
<body>

<div class="container">

<div class="header">
<h1>SoleMate</h1>
<p>Find the perfect shoes for your feet</p>
</div>

<div class="content">

<div id="catalogScreen" class="screen active">

  <!-- Top Controls: Filter button, Search bar, Questionnaire button -->
  <div class="top-controls">
  <button class="btn filter-toggle" onclick="toggleFilters()">Filter</button>

  <div style="position:relative;">
    <button class="btn" onclick="toggleSort()">Sort by</button>
    <div id="sortPanel" class="filter-panel" style="position:absolute;top:45px;left:0;display:none;min-width:160px;z-index:10;">
      <div class="option" onclick="setSort('alpha-asc')">Alphabetical A→Z</div>
      <div class="option" onclick="setSort('alpha-desc')">Alphabetical Z→A</div>
      <div class="option" onclick="setSort('price-asc')">Price Low→High</div>
      <div class="option" onclick="setSort('price-desc')">Price High→Low</div>
    </div>
  </div>

  <input type="text" id="shoeSearch" placeholder="Search shoes..." 
         oninput="displayShoes()" 
         style="flex:1; min-width:200px; max-width:400px; height:40px; padding:0 12px; border-radius:6px; border:1px solid #ccc;">

  <button class="btn" onclick="goToQuestionnaire()">Personalize Shoes</button>
</div>

  <!-- Filter Panel -->
  <div id="filterPanel" class="filter-panel">
    <label>
      Width:
      <select id="widthFilter" onchange="setFilter('width', this.value)">
        <option value="all">All</option>
        <option value="narrow">Narrow</option>
        <option value="medium">Medium</option>
        <option value="wide">Wide</option>
        <option value="extra-wide">Extra Wide</option>
      </select>
    </label>

    <label style="margin-top:10px; display:block;">
      Activity:
      <select id="activityFilter" onchange="setFilter('activity', this.value)">
        <option value="all">All</option>
        <option value="running">Running</option>
        <option value="casual">Casual</option>
        <option value="hiking">Hiking</option>
        <option value="sports">Sports</option>
      </select>
    </label>

    <label style="margin-top:10px; display:block;">
      Gender:
      <select id="genderFilter" onchange="setFilter('gender', this.value)">
        <option value="all">All</option>
        <option value="men">Men</option>
        <option value="women">Women</option>
      </select>
    </label>
  </div>

  <div id="recommendationBox" style="margin-bottom:20px;"></div>

  <div class="shoes-grid" id="shoesGrid"></div>

</div>

<div id="questionnaireScreen" class="screen">
<div class="questionnaire">
<h2>Find Your Perfect Fit</h2>

<div class="question">
<h3>Activity</h3>
<div class="options" id="qPurpose">
  <div class="option" onclick="selectQ('purpose','running',this)">Running</div>
  <div class="option" onclick="selectQ('purpose','casual',this)">Casual</div>
  <div class="option" onclick="selectQ('purpose','hiking',this)">Hiking</div>
  <div class="option" onclick="selectQ('purpose','sports',this)">Sports</div>
</div>
</div>

<div class="question">
<h3>Width</h3>
<div class="options" id="qWidth">
<div class="option" onclick="selectQ('width','narrow',this)">Narrow</div>
<div class="option" onclick="selectQ('width','medium',this)">Medium</div>
<div class="option" onclick="selectQ('width','wide',this)">Wide</div>
<div class="option" onclick="selectQ('width','extra-wide',this)">Extra Wide</div>
</div>
</div>

<div class="question">
<h3>Gender</h3>
<div class="options" id="qGender">
<div class="option" onclick="selectQ('gender','men',this)">Men</div>
<div class="option" onclick="selectQ('gender','women',this)">Women</div>
</div>
</div>

<div class="btn-container">
<button class="btn" id="submitQ" onclick="submitQuestionnaire()" disabled>Show Recommendations</button>
</div>
</div>
</div>

</div>
</div>

<script>
let shoes = [];
let userPref = { purpose:null, width:null, gender:null };
let filter = { width:'all', activity:'all', gender:'all' };
let showUserPref = false;
let currentSort = 'alpha-asc';

document.addEventListener('DOMContentLoaded', loadShoes);

async function loadShoes(){
    try{
        const res = await fetch('nike-shoes.json');
        shoes = await res.json();
        displayShoes();
    }catch(e){console.error(e);}
}

function toggleFilters(){
    document.getElementById('filterPanel').classList.toggle('show');
}

function setFilter(type, value){
    filter[type] = value;
    showUserPref = false; // This for unpersonalized shoes
    displayShoes();
}

function goToQuestionnaire(){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById('questionnaireScreen').classList.add('active');
}

function selectQ(type, value, el){
    const capType = type.charAt(0).toUpperCase() + type.slice(1);
    document.querySelectorAll(`#q${capType} .option`).forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');

    userPref[type] = value;

    // This is to only allow filters if all fields are selected
    document.getElementById('submitQ').disabled = !(userPref.purpose && userPref.width && userPref.gender);
}

function submitQuestionnaire(){
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById('catalogScreen').classList.add('active');
    showUserPref = true; // show only personalized shoes
    showRecommendation();
    displayShoes();
}

function showRecommendation(){
    const purposeText={running:'running',casual:'casual',hiking:'hiking',sports:'sports'};
    const widthText={narrow:'narrow',medium:'medium',wide:'wide','extra-wide':'extra-wide'};
    document.getElementById('recommendationBox').innerHTML =
        `<p>Based on your choices: <strong>${purposeText[userPref.purpose]}</strong> for <strong>${widthText[userPref.width]}</strong> (${userPref.gender}), here are your best options:</p>`;
}

function toggleSort(){
    const panel = document.getElementById('sortPanel');
    panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
}

function setSort(sortType){
    currentSort = sortType;

    document.querySelectorAll('#sortPanel .option').forEach(o => o.classList.remove('selected'));
    document.querySelector(`#sortPanel .option[onclick="setSort('${sortType}')"]`).classList.add('selected');

    document.getElementById('sortPanel').style.display = 'none';
    displayShoes();
}
function displayShoes(){
    const grid = document.getElementById('shoesGrid');
    const searchTerm = document.getElementById('shoeSearch').value.toLowerCase();
    grid.innerHTML = '';

    let filtered = shoes.filter(s => {
        const activeFilter = showUserPref ? userPref : filter;

        return (
            (activeFilter.width === 'all' || s.width === activeFilter.width) &&
            (activeFilter.activity === 'all' || s.category === (activeFilter.purpose || activeFilter.activity)) &&
            (activeFilter.gender === 'all' || s.gender === activeFilter.gender) &&
            s.name.toLowerCase().includes(searchTerm)
        );
    });

    filtered.sort((a,b) => {
        if(currentSort === 'alpha-asc') return a.name.localeCompare(b.name);
        if(currentSort === 'alpha-desc') return b.name.localeCompare(a.name);
        if(currentSort === 'price-asc') return a.price - b.price;
        if(currentSort === 'price-desc') return b.price - a.price;
    });

    filtered.forEach(s=>{
        const card = document.createElement('div');
        card.className = 'shoe-card';
        card.innerHTML = `
          <div class="shoe-image" style="position:relative;">
            <a href="shoe-detail.html?shoe=${encodeURIComponent(s.name)}" target="_blank">
              <img src="${s.image}" alt="${s.name}" onerror="this.src=''">
            </a>
            ${s.gender == 'men' ? `<div style="position:absolute;top:8px;right:8px;background:rgba(59,130,246,0.85);color:white;font-size:12px;font-weight:600;padding:3px 8px;border-radius:20px;">♂ Men</div>` : `<div style="position:absolute;top:8px;right:8px;background:rgba(255,20,147,0.4);color:white;font-size:11px;font-weight:600;padding:3px 8px;border-radius:20px;">♀ Women</div>`}
          </div>
          <div class="shoe-name">${s.name}</div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px;">
            <div class="shoe-price">$${s.price}</div>
          </div>
        `;
        grid.appendChild(card);
    });
}
</script>
</body>
</html>
